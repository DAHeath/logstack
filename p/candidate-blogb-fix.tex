\documentclass[]{llncs}
\pagestyle{plain}

\let\proof\relax
\let\endproof\relax

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{tikz}
\usepackage{todonotes}
\usepackage{xspace}

\usepackage{cleveref}
% cleveref config
\crefname{lemma}{lemma}{lemmas}
\Crefname{lemma}{Lemma}{Lemmas}
\crefname{theorem}{theorem}{theorems}
\Crefname{theorem}{Theorem}{Theorems}
\crefname{algocfline}{line}{lines}
\Crefname{algocfline}{Line}{Lines}

\usepackage{url}

\usepackage[linesnumbered,noend,noline]{algorithm2e}

\usepackage{changepage} % adjustwidth
\usepackage{comment}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\newcommand{\ourapproach}{\ensuremath{\textsf{OurApproach}}} % TODO

\newcommand{\stack}{\ensuremath{\textsf{Stack}}\xspace}

\newcommand{\E}{\ensuremath{\mathtt{Eval}}\xspace}
\newcommand{\G}{\ensuremath{\mathtt{Gen}}\xspace}
\newcommand{\cond}{\ensuremath{\mathtt{Cond}}\xspace}
\newcommand{\GS}{\ensuremath{\mathtt{GS}}\xspace}
\newcommand{\sgc}{Stacked Garbling}
\newcommand{\Gen}{\ensuremath{\mathsf{Gen}}}
\newcommand{\Eval}{\ensuremath{\mathsf{Eval}}}
\newcommand{\Ev}{\ensuremath{\mathsf{Ev}}}
\newcommand{\Gb}{\ensuremath{\mathsf{Gb}}}
\newcommand{\cir}{\ensuremath{\mathcal C}}
\newcommand{\gcir}{\ensuremath{\hat{\cir}}}
\newcommand{\mat}{\ensuremath{M}}
\newcommand{\mmat}{\ensuremath{\vec{M}}}
\newcommand{\scheme}{\ensuremath{\mathcal S}}

\newcommand{\guess}{\ensuremath{\mathtt{guess}}\xspace}
\newcommand{\truth}{\ensuremath{\mathtt{truth}}\xspace}
\newcommand{\aid}{\ensuremath{\mathtt{ID_{Active}}}\xspace}


\newcommand{\gb}{\ensuremath{\mathtt{Gb}}\xspace}
\newcommand{\ev}{\ensuremath{\mathtt{Ev}}\xspace}
\newcommand{\evcond}{\ensuremath{\mathtt{EvCond}}\xspace}
\newcommand{\gbcond}{\ensuremath{\mathtt{GbCond}}\xspace}
\newcommand{\genprojection}{\ensuremath{\mathtt{GenProjection}}\xspace}



\newcommand{\codecomment}[1]{\triangleright~\text{#1}}
\newcommand{\switch}{\ensuremath{\mathtt{switch}}\xspace}
\newcommand{\ccase}{\ensuremath{\mathtt{case}}\xspace}
\newcommand{\cfor}{\ensuremath{\mathtt{for}}\xspace}
\newcommand{\creturn}{\ensuremath{\mathtt{return}}\xspace}

\newcommand{\HK}{\cite{EPRINT:HeaKol20b}\xspace}

\newcommand{\vlad}[1]{{\todo{Vlad:{#1}}}}
\newcommand{\dave}[1]{{\todo{Dave:{#1}}}}

\begin{document}
\begin{figure}
  \begin{align*}
    &\codecomment{When we reach a leaf, the vector \mmat\ contains the
  $\log b$ possible garbage materials}\\
    &\codecomment{used to evaluate that leaf}\\
    &\gbcond(\vec{\cir}, S, \mmat):\\
    &~~\switch~\vec{\cir}:\\
    &~~~~\ccase~(\cir):\\
    &~~~~~~\codecomment{Base case of $1$ branch.}\\
    &~~~~~~M, e, d \gets \gb(\cir, S)\\
    &~~~~~~\codecomment{Return material, encoding string, decoding string, and empty garbage outputs.}\\
    &~~~~~~\creturn~M, e, d, \lambda\\
    &~~~~\ccase~(\cir_1..\cir_b):\\
    &~~~~~~\codecomment{General case of $b$ branches.}\\
    &~~~~~~\codecomment{Split material into demultiplexer and body of subtrees.}\\
    &~~~~~~e \gets \genprojection(n)\\
    &~~~~~~S^0, S^1 \gets e[0]\\
    &~~~~~~\codecomment{Garble both subtrees.}\\
    &~~~~~~M_0,e_0,d_0,junk_0 \gets \gbcond((\cir_1..\cir_{\frac{b}{2}}), S^1)\\
    &~~~~~~M_1,e_1,d_1,junk_1 \gets \gbcond((\cir_{\frac{b}{2}+1}..\cir_b), S^0)\\
    &~~~~~~\codecomment{Garble both subtrees with ``bad'' seeds.}\\
    &~~~~~~M_0',\cdot \gets \gbcond'((\cir_1..\cir_{\frac{b}{2}}), S^0)\\
    &~~~~~~M_1',\cdot \gets \gbcond'((\cir_{\frac{b}{2}+1}..\cir_b), S^1)\\
    &~~~~~~M_{dem},\bot_0, \bot_1 \gets dem.\gb(S^0, S^1, e, e_0, e_1)\\
    &~~~~~~\bot_0' \gets \evcond((\cir_1..\cir_{\frac{b}{2}}), (M_0 \oplus M_1) \oplus M_1', \bot_0)\\
    &~~~~~~\bot_1' \gets \evcond((\cir_{\frac{b}{2}+1}..\cir_b), (M_0 \oplus M_1) \oplus M_0', \bot_1)\\
    &~~~~~~\creturn~M_{dem}|(M_0\oplus M_1), e, (d_0,d_1), (junk_0,\bot_0',junk_1,\bot_1')
  \end{align*}
  \caption{%
    The algorithm for garbling a conditional vector.
    Given $b$ branches, \gbcond returns (1) the stacked material, (2)
    the input encoding string, (3) all $b$ output decoding strings,
    and (4) all $b\log b$ possible garbage output label vectors.
  }
\end{figure}
\end{document}
